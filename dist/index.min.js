!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).funcyjs={})}(this,function(e){"use strict";let t,n;const s=[],o=new(WeakMap||Map),r=new(WeakMap||Map),i=e=>(function r(){const i=s[n][0];t++;const a=s[n][t]||(s[n][t]=[{context:i,hook:e}]);return(o.get(r)||e).apply({},a.concat(Array.from(arguments)))}),a=(e,t)=>{const o=s[n].map(e=>{if(e[0]&&e[0][t]){const n=e[0][t]();return e[0][t]=0,n}}).filter(e=>e instanceof Promise);if(o.length>0){const t=Promise.all(o);r.set(e,r.has(e)?r.get(e).then(t):t)}},c=(e,t)=>{if(r.has(e)){const n=r.get(e).then(t);return r.set(e,n),n}return t()},u=function(){const e=Array.from(arguments);let i;return e[0].pop&&(i=e.shift()),((e,i,u,f)=>{if(!0!==i)return c(e,()=>(t=0,n=s.push(o.get(e)||[e])-1,o.set(e,s[n]),a(e,"before"),c(e,()=>{let t=u.apply(u,f);return a(e,"after"),c(e,()=>(s.pop(),r.delete(e),t))})));r.set(e,a(e,"cleanUp")),o.delete(e)})("boolean"==typeof e[1]?e[0]:e[1]||e[0],!0===e[1]||e[2],e[0],i)},f=i((e,t,n,s)=>(e.s=void 0!==e.s?e.s:s?s(n):n,[e.s,n=>(e.s=t(e.s,n),e.s)])),p=i((e,t,n)=>{e.v&&(!n||n.length===e.v.length&&n.every(t=>~e.v.indexOf(t)))||(e.v=n,e.cleanUp&&e.cleanUp(),e.after=(()=>{let n=t();return n instanceof Promise?n=n.then(t=>e.cleanUp=t):e.cleanUp=n,n}))}),d=i(e=>e.context),l=[];let h,m=!1;const v=async()=>{if(!m&&l.length>0){h=h||Date.now(),m=!0;const e=l.pop();await e.render();const t=()=>{m=!1,v()};Date.now()-h>66?requestAnimationFrame(t):t()}},b=e=>{-1===l.indexOf(e)&&l.push(e),v()};var y,g;y=f,g=((e,t,n,s)=>{const[o,r]=e.hook(e,t,n,s);return[o,t=>{const n=r(t);return o!==n&&b(e.context),n}]}),o.set(y,g);const w=new(WeakMap||Map),x=i((e,t,n)=>{const s=e.context;let o=e.v;if(!o){let r=!1;if(void 0===s[t]||s.hasOwnProperty(t)){let e=s[t]||n;Object.defineProperty(s,t,{set:t=>{e!==t&&(e=t,r||b(s))},get:()=>e})}o=(e=>{r=!0,s[t]=e,r=!1}),void 0===s[t]&&o(n),e.v=o}return[s[t],o]}),M=i((e,t)=>{e.context.renderer=t});e.useHostElement=d,e.useAttribute=((e,t)=>{const n=d();n.hasAttribute(e)||void 0===t||n.setAttribute(e,t);const s=n.getAttribute(e);let o;return w.has(n)?o=w.get(n):(o=new MutationObserver(e=>{b(n)}),w.set(n,o),o.observe(n,{attributes:!0})),[s,t=>{o.disconnect(),n.setAttribute(e,t),o.observe(n,{attributes:!0})}]}),e.useProp=x,e.useRenderer=M,e.component=function(e,t,n){customElements.define(e,class extends HTMLElement{constructor(){super(),this.shadowRoot||this.attachShadow(Object.assign({mode:"open"},n)),b(this)}renderer(e,t){e&&!(e instanceof NodeList?t.contains(e[0]):t.contains(e))&&(t.innerHTML="",e instanceof NodeList?e.forEach(e=>t.appendChild(e)):t.appendChild(e))}render(){const e=u(t,this);return this.renderer(e,this.shadowRoot)}})},e.useReducer=f,e.useState=(e=>{const[t,n]=f((e,t)=>t.value,e);return[t,e=>n({value:e})]}),e.useEffect=((e,t)=>{p(()=>new Promise(t=>requestAnimationFrame(n=>t(e()))),t)}),Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.min.js.map
