{"version":3,"file":"index.min.js","sources":["../node_modules/hookuspocus/src/core.js","../node_modules/hookuspocus/src/use_reducer.js","../node_modules/hookuspocus/src/use_layout_effect.js","../src/hooks/use_host_element.js","../src/render_qeue.js","../node_modules/hookuspocus/src/on.js","../src/hooks/use_attribute.js","../src/hooks/use_prop.js","../src/hooks/use_renderer.js","../src/component.js","../node_modules/hookuspocus/src/use_state.js","../node_modules/hookuspocus/src/use_effect.js"],"sourcesContent":["const runMap = window.___hookusPocusRunMap || new (WeakMap || Map)();\nwindow.___hookusPocusRunMap = runMap;\n\nconst hookDataStack = runMap.h || [];\nrunMap.h = hookDataStack;\n\nexport const dataMap = runMap.d || new (WeakMap || Map)();\nrunMap.d = dataMap;\nexport const hookus = hookFunction => {\n  return function hook() {\n    const context = hookDataStack[runMap.stackIndex][0];\n    runMap.hookIndex++;\n    const data =\n      hookDataStack[runMap.stackIndex][runMap.hookIndex] ||\n      (hookDataStack[runMap.stackIndex][runMap.hookIndex] = [\n        { context, hook: hookFunction }\n      ]);\n    return (dataMap.get(hook) || hookFunction).apply(\n      {},\n      data.concat(Array.from(arguments))\n    );\n  };\n};\nconst runLifeCycles = (context, name) => {\n  const promises = hookDataStack[runMap.stackIndex]\n    .map(data => {\n      if (data[0] && data[0][name]) {\n        const result = data[0][name]();\n        data[0][name] = 0;\n        return result;\n      }\n    })\n    .filter(result => result instanceof Promise);\n  if (promises.length > 0) {\n    const promiseAll = Promise.all(promises);\n    runMap.set(\n      context,\n      runMap.has(context) ? runMap.get(context).then(promiseAll) : promiseAll\n    );\n  }\n};\nconst waitForContext = (context, cb) => {\n  if (runMap.has(context)) {\n    const promise = runMap.get(context).then(cb);\n    runMap.set(context, promise);\n    return promise;\n  } else {\n    return cb();\n  }\n};\nconst run = (context, cleanUp, func, args) => {\n  if (cleanUp === true) {\n    runMap.set(context, runLifeCycles(context, \"cleanUp\"));\n    dataMap.delete(context);\n  } else {\n    return waitForContext(context, () => {\n      runMap.hookIndex = 0;\n      runMap.stackIndex =\n        hookDataStack.push(dataMap.get(context) || [context]) - 1;\n      dataMap.set(context, hookDataStack[runMap.stackIndex]);\n      runLifeCycles(context, \"before\");\n      return waitForContext(context, () => {\n        let result = func.apply(func, args);\n        runLifeCycles(context, \"after\");\n        return waitForContext(context, () => {\n          hookDataStack.pop();\n          runMap.delete(context);\n          return result;\n        });\n      });\n    });\n  }\n};\nexport const pocus = function() {\n  const args = Array.from(arguments);\n  let funcArgs;\n  if (args[0][\"pop\"]) {\n    funcArgs = args.shift();\n  }\n  const context = typeof args[1] === \"boolean\" ? args[0] : args[1] || args[0];\n  const cleanUp = args[1] === true || args[2];\n  return run(context, cleanUp, args[0], funcArgs);\n};\n","import { hookus } from \"./core\";\n\nexport const useReducer = hookus((data, reducer, initialArg, init) => {\n  data.s = data.s !== undefined ? data.s : init ? init(initialArg) : initialArg;\n  return [\n    data.s,\n    action => {\n      data.s = reducer(data.s, action);\n      return data.s;\n    }\n  ];\n});\n","import { hookus } from \"./core\";\nexport const useLayoutEffect = hookus((data, effect, values) => {\n  if (\n    !data.v ||\n    (values &&\n      !(\n        values.length === data.v.length &&\n        values.every(value => ~data.v.indexOf(value))\n      ))\n  ) {\n    data.v = values;\n    if (data.cleanUp) {\n      data.cleanUp();\n    }\n    data.after = () => {\n      let result = effect();\n      if (result instanceof Promise) {\n        result = result.then(cleanUp => (data.cleanUp = cleanUp));\n      } else {\n        data.cleanUp = result;\n      }\n      return result;\n    };\n  }\n});\n","import { hookus } from \"../../node_modules/hookuspocus/src/index\";\n\nexport const useHostElement = hookus(data => {\n  return data.context;\n});\n","import { on, useReducer } from \"../node_modules/hookuspocus/src/index\";\nwindow.___funcyJsRenderQueue;\nconst createRenderPromise = component => {\n  const promise = new Promise(resolve => resolve(component.render())).then(\n    _ => {\n      if ((window.___funcyJsRenderQueue = promise)) {\n        window.___funcyJsRenderQueue = undefined;\n      }\n    }\n  );\n};\nexport const queueRender = component => {\n  if (!window.___funcyJsRenderQueue) {\n    window.___funcyJsRenderQueue = createRenderPromise(component);\n  } else {\n    window.___funcyJsRenderQueue.then(() => createRenderPromise(component));\n  }\n};\non(useReducer, (data, reducer, initialArg, init) => {\n  const [state, dispatch] = data.hook(data, reducer, initialArg, init);\n  return [\n    state,\n    action => {\n      const result = dispatch(action);\n      if (state !== result) {\n        queueRender(data.context);\n      }\n      return result;\n    }\n  ];\n});\n","import { useReducer } from \"./use_reducer\";\nimport { dataMap } from \"./core\";\n\nexport const on = (hook, cb) => {\n  dataMap.set(hook, cb);\n};\nexport const onStateChanged = cb =>\n  on(useReducer, (data, reducer, initialArg, init) => {\n    const [state, dispatch] = data.hook(data, reducer, initialArg, init);\n    return [\n      state,\n      action => {\n        const result = dispatch(action);\n        if (state !== result) {\n          cb(data.context);\n        }\n        return result;\n      }\n    ];\n  });\n","import { useHostElement } from \"./use_host_element\";\nimport { queueRender } from \"../render_qeue\";\nconst observerMap = new (WeakMap || Map)();\nexport const useAttribute = (attributeName, initialValue) => {\n  const element = useHostElement();\n  if (!element.hasAttribute(attributeName) && initialValue !== undefined) {\n    element.setAttribute(attributeName, initialValue);\n  }\n  const attributeValue = element.getAttribute(attributeName);\n  let observer;\n  if (!observerMap.has(element)) {\n    observer = new MutationObserver(_ => {\n      queueRender(element);\n    });\n    observerMap.set(element, observer);\n    observer.observe(element, { attributes: true });\n  } else {\n    observer = observerMap.get(element);\n  }\n  return [\n    attributeValue,\n    value => {\n      observer.disconnect();\n      element.setAttribute(attributeName, value);\n      observer.observe(element, { attributes: true });\n    }\n  ];\n};\n","import { hookus } from \"../../node_modules/hookuspocus/src/index\";\nimport { queueRender } from \"../render_qeue\";\n\nexport const useProp = hookus((data, name, initialValue) => {\n  const element = data.context;\n  let setProp = data.v;\n  if (!setProp) {\n    let paused = false;\n    if (element[name] === undefined || element.hasOwnProperty(name)) {\n      let val = element[name] || initialValue;\n      Object.defineProperty(element, name, {\n        set: value => {\n          if (val !== value) {\n            val = value;\n            if (!paused) {\n              queueRender(element);\n            }\n          }\n        },\n        get: () => val\n      });\n    }\n    setProp = value => {\n      paused = true;\n      element[name] = value;\n      paused = false;\n    };\n    if (element[name] === undefined) {\n      setProp(initialValue);\n    }\n    data.v = setProp;\n  }\n  return [element[name], setProp];\n});\n","import { hookus } from \"../../node_modules/hookuspocus/src/index\";\n\nexport const useRenderer = hookus((data, rendererIn) => {\n  data.context.renderer = rendererIn;\n});\n","import { pocus } from \"../node_modules/hookuspocus/src/index\";\nimport { queueRender } from \"./render_qeue\";\nexport function component(name, comp, options) {\n  class Component extends HTMLElement {\n    constructor() {\n      super();\n      if (!this.shadowRoot) {\n        this.attachShadow(\n          Object.assign(\n            {\n              mode: \"open\"\n            },\n            options\n          )\n        );\n      }\n      queueRender(this);\n    }\n    renderer(view, shadowRoot) {\n      if (\n        view &&\n        !(view instanceof NodeList\n          ? shadowRoot.contains(view[0])\n          : shadowRoot.contains(view))\n      ) {\n        shadowRoot.innerHTML = \"\";\n        if (view instanceof NodeList) {\n          view.forEach(node => shadowRoot.appendChild(node));\n        } else {\n          shadowRoot.appendChild(view);\n        }\n      }\n    }\n    render() {\n      const view = pocus(comp, this);\n      return this.renderer(view, this.shadowRoot);\n    }\n  }\n  customElements.define(name, Component);\n}\n","import { useReducer } from \"./use_reducer\";\n\nexport const useState = initialState => {\n  const [state, dispatch] = useReducer(\n    (_, action) => action.value,\n    initialState\n  );\n  return [\n    state,\n    newState =>\n      dispatch({\n        value: newState\n      })\n  ];\n};\n","import { useLayoutEffect } from \"./use_layout_effect\";\n\nexport const useEffect = (effect, values) => {\n  useLayoutEffect(\n    () => new Promise(resolve => requestAnimationFrame(_ => resolve(effect()))),\n    values\n  );\n};\n"],"names":["runMap","window","___hookusPocusRunMap","WeakMap","Map","hookDataStack","h","dataMap","d","hookus","hookFunction","hook","context","stackIndex","hookIndex","data","get","apply","concat","Array","from","arguments","runLifeCycles","name","promises","map","result","filter","Promise","length","promiseAll","all","set","has","then","waitForContext","cb","promise","pocus","args","funcArgs","shift","cleanUp","func","push","pop","delete","run","useReducer","reducer","initialArg","init","s","undefined","action","useLayoutEffect","effect","values","v","every","value","indexOf","after","useHostElement","___funcyJsRenderQueue","createRenderPromise","component","resolve","render","_","queueRender","state","dispatch","observerMap","useProp","initialValue","element","setProp","paused","hasOwnProperty","val","Object","defineProperty","useRenderer","rendererIn","renderer","attributeName","hasAttribute","setAttribute","attributeValue","getAttribute","observer","MutationObserver","observe","attributes","disconnect","comp","options","customElements","define","HTMLElement","[object Object]","super","this","shadowRoot","attachShadow","assign","mode","view","NodeList","contains","innerHTML","forEach","node","appendChild","initialState","newState","requestAnimationFrame"],"mappings":"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"}