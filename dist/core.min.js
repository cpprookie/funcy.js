!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).funcyjs={})}(this,function(e){"use strict";const t=Symbol("outside_run");let n,o=t;const s=new(WeakMap||Map),r=()=>{o=t},a=(e,r)=>(...a)=>{if(o.context===t)throw new Error("Hook was called outside of run()!");n++;const i=(e=>{const t=s.get(o.context);void 0===t[n]&&(t[n]={});const r=t[n],a=o.onStateChange;return{onCleanUp(e){r.cleanUp=e},beforeNextRun(e){r.beforeNextRun=e},afterCurrentRun(e){r.afterCurrentRun=e},getApi:()=>o.api,getContext:()=>o.context,getState:e=>(void 0===r.state&&(r.state=e),r.state),setState(t,n=!1){let o=r.state;r.state=t,!n&&a&&a(e,o,t)}}})(e);return r(...a,i)};function i(e,t,n){let o=n;for(;o--;){const s=t[n-o-1];s[e]&&(s[e](),s[e]=void 0)}}const u=a("useReducer",(e,t,{getState:n,setState:o})=>{const s=n(t);return[s,t=>{o(e(s,t))}]}),c=a("useState",e=>{const[t,n]=u((e,t)=>t.value,e);return[t,e=>n({type:"set_state",value:e})]}),d=a("useEffect",(e,...t)=>{let n;t.length>1&&(n=t[0]);const{getState:o,setState:s,onCleanUp:r,afterCurrentRun:a}=t[t.length-1];let{values:i,cleanUp:u}=o({}),c=!1;if(i!==n&&i&&i.length>0){c=!0;let e=i.length;for(;e--;)if(n[e]!==i[e]){c=!1;break}i=n}c||(u&&u(),a(()=>{u=e(),s({values:n,cleanUp:u}),r(u?()=>{u()}:void 0)}))}),h=new Map;let l=!1;const p=[],f=e=>((e,{context:a,api:u,onStateChange:c=(()=>{})}={})=>{if(a||(a=e),!(a instanceof Object))throw new Error("Run was called without a valid object context!");if(o!==t)throw new Error("Run was called before the end of the previous run!");o={context:a,api:u,onStateChange:c},n=-1;let d=!1;s.has(a)||(s.set(a,[]),d=!0);const h=s.get(o.context),l=h.length;i("beforeNextRun",h,l);const p=e();return p instanceof Promise?p.then(e=>(i("afterCurrentRun",h,d?h.length:l),r(),e)):(i("afterCurrentRun",h,d?h.length:l),r(),p)})(()=>e.render(),{context:e,onStateChange:t=>{"useReducer"===t&&g(e)}}),C=async()=>{const e=p.length;l=!0,Promise.resolve().then(async()=>{let t=e;for(;t--;)await f(p[e-t-1]);p.splice(0,e),l=!1,p.length>0&&C()})},g=(e,t)=>{(-1===p.indexOf(e)&&!0===e._isConnected||t)&&p.push(e),l||C()},b=e=>{const t=h.get(e);return h.delete(e),t};let w=1e5;const x=(e,t)=>{(e instanceof NodeList?t.contains(e[0]):t.contains(e))||(t.innerHTML="",e instanceof NodeList?e.forEach(e=>t.appendChild(e)):t.appendChild(e))},S=new Map;const R=a("useHostElement",({getContext:e})=>e()),_=a("useShadowRoot",({getContext:e})=>e()._shadowRoot),m=a("useRenderer",(e,{getContext:t,getState:n})=>{const o=n(e);t()._renderer=o}),v=a("useAttribute",(e,{getContext:t})=>{const n=t();return[n.getAttribute(e),t=>{n.skipQueue=!0,n.setAttribute(e,t)}]}),E=a("useCSS",(e,...t)=>{let n;t.pop(),n=(n=e instanceof Array?e.map((e,n)=>t[n]?e+t[n]:e).join(""):e).replace(/ +(?= )/g,"").replace(/\n/g,"");const o=_(),s=document.createElement("style");s.innerHTML=n,d(()=>(o.appendChild(s),()=>{o.removeChild(s)}))}),y=a("useExposeMethod",(e,t,{getContext:n})=>{n()[e]=((...e)=>t(...e))}),k=a("useConnectedState",({getContext:e})=>{return e()._isConnected});e.defineComponent=((e,t,n={})=>{S.has(e)?console.warn(`Component ${e} was already defined.`):(S.set(e,t),function(e,t={}){customElements.define(e,class extends HTMLElement{constructor(){super(),this._props={},this._renderer=x,this._isConnected=!1}connectedCallback(){this._shadowRoot||(this._shadowRoot=this.attachShadow({mode:"open",...t.shadowOptions?t.shadowOptions:{}})),this._isConnected||(this._isConnected=!0,g(this))}disconnectedCallback(){this._isConnected&&(this._isConnected=!1,g(this,!0))}render(){const t=this.getAttribute("data-props");t&&(this._props=b(t),this.skipQueue=!0,this.removeAttribute("data-props"));const n=S.get(e)(this._props);this._renderer(n,this._shadowRoot),this.init=!1}attributeChangedCallback(e,t,n){this.init||(this.skipQueue||t===n||g(this),this.skipQueue=!1)}static get observedAttributes(){let e=["data-props"];return t.observedAttributes&&(e=e.concat(t.observedAttributes)),e}})}(e,n))}),e.prps=(e=>{return{"data-props":(e=>{let t=w.toString(16);return w++,t.length%2&&(t="0"+t),h.set(t,e),t})(e)}}),e.createHook=a,e.useReducer=u,e.useState=c,e.useEffect=d,e.useAttribute=v,e.useCSS=E,e.useExposeMethod=y,e.useRenderer=m,e.useHostElement=R,e.useShadowRoot=_,e.useConnectedState=k,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=core.min.js.map
