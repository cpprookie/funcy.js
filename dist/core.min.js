!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("hookuspocus")):"function"==typeof define&&define.amd?define(["exports","hookuspocus"],t):t((e=e||self).funcyjs={},e.hookuspocus)}(this,function(e,t){"use strict";const n=Symbol("outside_run");let o=n;const s=new(WeakMap||Map),r=()=>{o=n},a=(e,t)=>(...r)=>{if(o.context===n)throw new Error("Hook was called outside of run()!");o.hookStateIndex++;const a=(e=>{const t=s.get(o.context);void 0===t[o.hookStateIndex]&&(t[o.hookStateIndex]={});const n=t[o.hookStateIndex],r=o.onStateChange;return{onCleanUp(e){n.cleanUp=e},beforeNextRun(e){n.beforeNextRun=e},afterCurrentRun(e){n.afterCurrentRun=e},getContext:()=>o.context,getState:e=>(void 0===n.state&&(n.state=e),n.state),setState(t,o=!1){let s=n.state;n.state=t,!o&&r&&r(e,s,t)}}})(e);return t(...r,a)};function i(e,t,n){let o=n;for(;o--;){const s=t[n-o-1];s[e]&&(s[e](),s[e]=void 0)}}const c=e=>{const t=s.get(e);i("cleanUp",t,t.length),s.delete(e)},u=a("useEffect",(e,...t)=>{let n;t.length>1&&(n=t[0]);const{getState:o,setState:s,onCleanUp:r,afterCurrentRun:a}=t[t.length-1];let{values:i,cleanUp:c}=o({}),u=!1;if(i!==n&&i&&i.length>0){u=!0;let e=i.length;for(;e--;)if(n[e]!==i[e]){u=!1;break}i=n}u||(c&&c(),a(()=>{c=e(),s({values:n,cleanUp:c}),r(c?()=>{c()}:void 0)}))}),d=new Map;let h=!1;const l=[],p=e=>((e,...t)=>{if("function"==typeof e&&(e={context:e,function:e}),!(e.context instanceof Object))throw new Error("Run was called without a valid object context!");(o=e).hookStateIndex=-1;let n=!1;s.has(o.context)||(s.set(o.context,[]),n=!0);const a=s.get(o.context),c=a.length;i("beforeNextRun",a,c);const u=e.function(...t);return u instanceof Promise?u.then(e=>(i("afterCurrentRun",a,n?a.length:c),r(),e)):(i("afterCurrentRun",a,n?a.length:c),r(),u)})({context:e,onStateChange:(e,t,n)=>{console.log(e,t,n)},function:()=>e.render(),onStateChange:t=>{"useReducer"===t&&C(e)}}),f=async()=>{const e=l.length;h=!0,Promise.resolve().then(async()=>{let t=e;for(;t--;)await p(l[e-t-1]);l.splice(0,e),h=!1,l.length>0&&f()})},C=(e,t)=>{(-1===l.indexOf(e)&&!0===e._isConnected||t)&&l.push(e),h||f()},g=e=>{const t=d.get(e);return d.delete(e),t};let x=1e5;const S=(e,t)=>{(e instanceof NodeList?t.contains(e[0]):t.contains(e))||(t.innerHTML="",e instanceof NodeList?e.forEach(e=>t.appendChild(e)):t.appendChild(e))},b=new Map;const w=a("useAttribute",(e,{getContext:t})=>{const n=t();return[n.getAttribute(e),t=>{n.skipQueue=!0,n.setAttribute(e,t)}]}),m=a("useCSS",(e,...t)=>{const{getContext:n}=t.pop();let o;o=(o=e instanceof Array?e.map((e,n)=>t[n]?e+t[n]:e).join(""):e).replace(/ +(?= )/g,"").replace(/\n/g,"");const s=n()._shadowRoot,r=document.createElement("style");r.innerHTML=o,u(()=>(s.appendChild(r),()=>{s.removeChild(r)}))}),R=a("useExposeMethod",(e,t,{getContext:n})=>{n()[e]=((...e)=>t(...e))}),_=a("useRenderer",(e,{getContext:t,getState:n})=>{const o=n(e);t()._renderer=o}),k=a("useHostElement",({getContext:e})=>e()),v=a("useShadowRoot",({getContext:e})=>e()._shadowRoot),y=a("useConnectedState",({getContext:e})=>{return e()._isConnected});e.createHook=t.createHook,e.useReducer=t.useReducer,e.useState=t.useState,e.useEffect=t.useEffect,e.defineComponent=((e,t,n={})=>{b.has(e)?console.warn(`Component ${e} was already defined.`):(b.set(e,t),function(e,t={}){customElements.define(e,class extends HTMLElement{constructor(){super(),this._props={},this._renderer=S,this._isConnected=!1}connectedCallback(){this._shadowRoot||(this._shadowRoot=this.attachShadow({mode:"open",...t.shadowOptions?t.shadowOptions:{}})),this._isConnected||(this._isConnected=!0,C(this))}disconnectedCallback(){this._isConnected&&(this._isConnected=!1,C(this))}destroy(){this.parentElement.removeChild(this),c(this)}async render(){const t=this.getAttribute("data-props");t&&(this._props=g(t),this.skipQueue=!0,this.removeAttribute("data-props"));const n=await Promise.resolve().then(()=>b.get(e)(this._props));await this._renderer(n,this._shadowRoot),this.init=!1}attributeChangedCallback(e,t,n){this.init||(this.skipQueue||t===n||C(this),this.skipQueue=!1)}static get observedAttributes(){let e=["data-props"];return t.observedAttributes&&(e=e.concat(t.observedAttributes)),e}})}(e,n))}),e.prps=(e=>{return{"data-props":(e=>{let t=x.toString(16);return x++,t.length%2&&(t="0"+t),d.set(t,e),t})(e)}}),e.useAttribute=w,e.useCSS=m,e.useExposeMethod=R,e.useRenderer=_,e.useHostElement=k,e.useShadowRoot=v,e.useConnectedState=y,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=core.min.js.map
