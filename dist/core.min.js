!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).funcyjs={})}(this,function(e){"use strict";const t=Symbol("outside_run");let n=t;const o=new(WeakMap||Map),s=()=>{n=t},r=(e,s)=>(...r)=>{if(n.context===t)throw new Error("Hook was called outside of run()!");n.hookStateIndex++;const a=(e=>{const t=o.get(n.context);void 0===t[n.hookStateIndex]&&(t[n.hookStateIndex]={});const s=t[n.hookStateIndex],r=n.onStateChange;return{onCleanUp(e){s.cleanUp=e},beforeNextRun(e){s.beforeNextRun=e},afterCurrentRun(e){s.afterCurrentRun=e},getContext:()=>n.context,getState:e=>(void 0===s.state&&(s.state=e),s.state),setState(t,n=!1){let o=s.state;s.state=t,!n&&r&&r(e,o,t)}}})(e);return s(...r,a)};function a(e,t,n){let o=n;for(;o--;){const s=t[n-o-1];s[e]&&(s[e](),s[e]=void 0)}}const i=e=>{const t=o.get(e);a("cleanUp",t,t.length),o.delete(e)},c=r("useReducer",(e,t,{getState:n,setState:o})=>{const s=n(t);return[s,t=>{o(e(s,t))}]}),u=r("useState",e=>{const[t,n]=c((e,t)=>t.value,e);return[t,e=>n({type:"set_state",value:e})]}),d=r("useEffect",(e,...t)=>{let n;t.length>1&&(n=t[0]);const{getState:o,setState:s,onCleanUp:r,afterCurrentRun:a}=t[t.length-1];let{values:i,cleanUp:c}=o({}),u=!1;if(i!==n&&i&&i.length>0){u=!0;let e=i.length;for(;e--;)if(n[e]!==i[e]){u=!1;break}i=n}u||(c&&c(),a(()=>{c=e(),s({values:n,cleanUp:c}),r(c?()=>{c()}:void 0)}))}),h=new Map;let l=!1;const p=[],f=e=>((e,...t)=>{if("function"==typeof e&&(e={context:e,function:e}),!(e.context instanceof Object))throw new Error("Run was called without a valid object context!");(n=e).hookStateIndex=-1;let r=!1;o.has(n.context)||(o.set(n.context,[]),r=!0);const i=o.get(n.context),c=i.length;a("beforeNextRun",i,c);const u=e.function(...t);return u instanceof Promise?u.then(e=>(a("afterCurrentRun",i,r?i.length:c),s(),e)):(a("afterCurrentRun",i,r?i.length:c),s(),u)})({context:e,onStateChange:(e,t,n)=>{console.log(e,t,n)},function:()=>e.render(),onStateChange:t=>{"useReducer"===t&&g(e)}}),C=async()=>{const e=p.length;l=!0,Promise.resolve().then(async()=>{let t=e;for(;t--;)await f(p[e-t-1]);p.splice(0,e),l=!1,p.length>0&&C()})},g=(e,t)=>{(-1===p.indexOf(e)&&!0===e._isConnected||t)&&p.push(e),l||C()},x=e=>{const t=h.get(e);return h.delete(e),t};let S=1e5;const b=(e,t)=>{(e instanceof NodeList?t.contains(e[0]):t.contains(e))||(t.innerHTML="",e instanceof NodeList?e.forEach(e=>t.appendChild(e)):t.appendChild(e))},w=new Map;const _=r("useAttribute",(e,{getContext:t})=>{const n=t();return[n.getAttribute(e),t=>{n.skipQueue=!0,n.setAttribute(e,t)}]}),m=r("useCSS",(e,...t)=>{const{getContext:n}=t.pop();let o;o=(o=e instanceof Array?e.map((e,n)=>t[n]?e+t[n]:e).join(""):e).replace(/ +(?= )/g,"").replace(/\n/g,"");const s=n()._shadowRoot,r=document.createElement("style");r.innerHTML=o,d(()=>(s.appendChild(r),()=>{s.removeChild(r)}))}),R=r("useExposeMethod",(e,t,{getContext:n})=>{n()[e]=((...e)=>t(...e))}),v=r("useRenderer",(e,{getContext:t,getState:n})=>{const o=n(e);t()._renderer=o}),k=r("useHostElement",({getContext:e})=>e()),y=r("useShadowRoot",({getContext:e})=>e()._shadowRoot),E=r("useConnectedState",({getContext:e})=>{return e()._isConnected});e.defineComponent=((e,t,n={})=>{w.has(e)?console.warn(`Component ${e} was already defined.`):(w.set(e,t),function(e,t={}){customElements.define(e,class extends HTMLElement{constructor(){super(),this._props={},this._renderer=b,this._isConnected=!1}connectedCallback(){this._shadowRoot||(this._shadowRoot=this.attachShadow({mode:"open",...t.shadowOptions?t.shadowOptions:{}})),this._isConnected||(this._isConnected=!0,g(this))}disconnectedCallback(){this._isConnected&&(this._isConnected=!1,g(this))}destroy(){this.parentElement.removeChild(this),i(this)}async render(){const t=this.getAttribute("data-props");t&&(this._props=x(t),this.skipQueue=!0,this.removeAttribute("data-props"));const n=await Promise.resolve().then(()=>w.get(e)(this._props));await this._renderer(n,this._shadowRoot),this.init=!1}attributeChangedCallback(e,t,n){this.init||(this.skipQueue||t===n||g(this),this.skipQueue=!1)}static get observedAttributes(){let e=["data-props"];return t.observedAttributes&&(e=e.concat(t.observedAttributes)),e}})}(e,n))}),e.prps=(e=>{return{"data-props":(e=>{let t=S.toString(16);return S++,t.length%2&&(t="0"+t),h.set(t,e),t})(e)}}),e.createHook=r,e.useReducer=c,e.useState=u,e.useEffect=d,e.useAttribute=_,e.useCSS=m,e.useExposeMethod=R,e.useRenderer=v,e.useHostElement=k,e.useShadowRoot=y,e.useConnectedState=E,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=core.min.js.map
